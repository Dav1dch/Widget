# 年度进度 Widget 测试指南

## 测试前准备

### 1. 环境检查
- ✅ Android Studio 已安装并配置好
- ✅ JDK 17 或更高版本
- ✅ Android SDK 34 已安装
- ✅ 模拟器已创建或真机已连接

### 2. 项目准备
- ✅ 项目已同步（`File -> Sync Project with Gradle Files`）
- ✅ 构建无错误（`Build -> Make Project`）

## 测试步骤

### 步骤1: 安装应用

1. 在 Android Studio 中点击 Run 按钮（绿色三角形）
2. 或使用快捷键 `Shift + F10`
3. 等待应用安装到设备
4. 应用会自动启动，显示欢迎界面

**预期结果:**
- 应用成功安装
- 主界面显示"欢迎使用 Android Widget"
- 显示提示信息："长按桌面空白处，选择小组件"

### 步骤2: 添加年度进度Widget到桌面

#### 方法A: 长按桌面（推荐）
1. 长按设备桌面空白区域
2. 在弹出菜单中选择"小组件"或"Widgets"
3. 滚动查找"年度进度"
4. 长按 Widget 缩略图
5. 拖拽到桌面指定位置
6. 松开手指完成添加

#### 方法B: 通过应用抽屉
1. 打开应用抽屉
2. 找到"小组件"或"Widgets"应用
3. 搜索或找到"年度进度"
4. 点击添加
5. 选择Widget大小（如果支持多种尺寸）
6. 确认添加

**预期结果:**
- Widget成功添加到桌面
- 显示蓝色渐变背景
- 显示年份（如"2024年"）
- 显示已过天数/总天数（如"123/366 天"）
- 显示进度条和百分比
- 显示剩余天数

### 步骤3: 测试Widget显示功能

1. 观察 Widget 各项显示是否正确
2. 检查年份是否为当前年份
3. 检查已过天数是否正确
4. 检查进度百分比是否准确
5. 检查剩余天数是否正确
6. 检查进度条是否与百分比匹配

**预期结果:**
- 年份显示正确
- 已过天数计算准确
- 进度百分比精确到小数点后一位
- 剩余天数计算正确
- 进度条长度与百分比一致

### 步骤4: 测试Widget更新功能

1. 等待1小时，观察Widget是否自动更新
2. 手动更新Widget（通过代码调用更新方法）
3. 修改系统时间，观察Widget变化

**预期结果:**
- Widget按配置的更新周期自动更新
- 数据在更新后实时反映当前状态
- 进度百分比随时间增加

### 步骤5: 测试Widget交互功能

1. 点击Widget上的年份
2. 观察是否跳转到主Activity

**预期结果:**
- 点击年份后成功打开主Activity
- 主Activity正常显示

### 步骤6: 测试Widget调整大小功能

1. 长按Widget
2. 拖动边框调整大小
3. 观察Widget内容布局是否适应

**预期结果:**
- Widget可以调整大小
- 调整大小后内容布局正常
- 不出现内容错位或被截断

### 步骤7: 测试不同屏幕尺寸

1. 尝试在不同密度的屏幕上测试
   - MDPI (320dpi)
   - HDPI (480dpi)
   - XHDPI (320dpi)
   - XXHDPI (480dpi)
   - XXXHDPI (640dpi)

2. 尝试在不同屏幕尺寸的设备上测试
   - 小屏手机
   - 大屏手机
   - 平板

**预期结果:**
- Widget 在所有设备上都能正常显示
- 文字大小适中
- 布局无错位
- 进度条显示正常

### 步骤8: 测试深色模式

1. 进入系统设置
2. 切换到深色模式
3. 观察Widget外观

**预期结果:**
- Widget在深色模式下仍然显示正常
- 保持蓝色渐变背景和白色文字
- 可读性良好

### 步骤9: 测试闰年情况

1. 将系统时间调整为闰年（如2024年）
2. 观察Widget显示
3. 检查总天数是否为366天
4. 将系统时间调整为非闰年（如2023年）
5. 观察Widget显示
6. 检查总天数是否为365天

**预期结果:**
- 闰年时总天数为366天
- 非闰年时总天数为365天
- 进度计算准确

### 步骤10: 测试边界情况

1. 测试年初（1月1日）
   - 已过天数应为1
   - 剩余天数应为365/364

2. 测试年末（12月31日）
   - 已过天数应为365/366
   - 剩余天数应为0

3. 测试年中（6月30日左右）
   - 已过天数应接近182/183
   - 进度应接近50%

**预期结果:**
- 年初数据显示正确
- 年末数据显示正确
- 年中数据显示正确
- 边界情况下无异常

## 测试清单

### 功能测试
- [ ] 应用可以正常安装
- [ ] 应用可以正常启动
- [ ] 可以找到"年度进度"Widget
- [ ] 可以添加Widget到桌面
- [ ] Widget显示正常
- [ ] 年份显示正确
- [ ] 已过天数计算正确
- [ ] 进度百分比准确
- [ ] 剩余天数计算正确
- [ ] 进度条显示正确
- [ ] Widget可以移除
- [ ] Widget可以重新添加

### 更新测试
- [ ] Widget按周期自动更新
- [ ] 手动更新功能正常
- [ ] 更新后数据准确

### 交互测试
- [ ] 点击Widget可以打开主Activity
- [ ] Widget可以调整大小
- [ ] 调整大小后布局正常

### 兼容性测试
- [ ] 在Android 8.0+设备上测试
- [ ] 在不同屏幕密度上测试
- [ ] 在不同屏幕尺寸上测试
- [ ] 在不同启动器上测试

### 视觉测试
- [ ] 颜色显示正确（蓝色渐变）
- [ ] 文字清晰可读
- [ ] 布局无错位
- [ ] 圆角效果正常
- [ ] 深色模式显示正常

### 性能测试
- [ ] 应用启动速度快
- [ ] Widget更新流畅
- [ ] 不影响系统性能
- [ ] 不消耗过多电量
- [ ] 内存占用合理

### 边界测试
- [ ] 年初（1月1日）显示正确
- [ ] 年末（12月31日）显示正确
- [ ] 闰年计算正确
- [ ] 非闰年计算正确

## 常见问题排查

### 问题1: 找不到年度进度Widget

**可能原因:**
- 应用未正确安装
- Widget未在Manifest中正确声明
- 系统缓存问题
- Widget Provider未正确注册

**解决方法:**
1. 检查应用是否已安装
2. 检查 AndroidManifest.xml 中的注册配置
3. 重启设备
4. 清除系统缓存
5. 重新安装应用

### 问题2: Widget显示异常

**可能原因:**
- 布局文件错误
- 资源文件缺失
- 权限问题
- 数据计算错误

**解决方法:**
1. 检查 `year_progress_widget.xml` 布局
2. 检查 `drawable` 资源是否存在
3. 查看 Logcat 日志
4. 清理项目后重新构建（`Build -> Clean Project`）
5. 检查 DateUtils 计算逻辑

### 问题3: Widget无法添加

**可能原因:**
- 权限不足
- 系统限制（某些定制ROM）
- Widget配置错误

**解决方法:**
1. 检查 `year_progress_widget_info.xml` 配置
2. 尝试使用其他启动器
3. 查看系统日志
4. 检查 Widget Provider 的 exported 属性

### 问题4: 进度计算不准确

**可能原因:**
- 日期计算逻辑错误
- 闰年判断错误
- 时区问题

**解决方法:**
1. 检查 DateUtils.calculateYearProgress() 方法
2. 验证 isLeapYear() 方法
3. 检查系统时区设置
4. 添加日志输出进行调试

### 问题5: Widget不更新

**可能原因:**
- `updatePeriodMillis` 设置过大
- 系统省电模式限制
- Widget被休眠

**解决方法:**
1. 检查 Widget 配置中的更新周期
2. 关闭省电模式测试
3. 手动触发更新
4. 检查 onReceive 方法是否正确处理广播

## 日志查看

### 启用Widget调试

在 `YearProgressWidgetProvider.kt` 中添加日志：

```kotlin
private fun updateAppWidget(
    context: Context,
    appWidgetManager: AppWidgetManager,
    appWidgetId: Int
) {
    android.util.Log.d("YearProgressWidget", "Updating widget: $appWidgetId")
    
    val yearProgress = DateUtils.calculateYearProgress()
    android.util.Log.d("YearProgressWidget", "Year progress: ${yearProgress.progressPercentage}%")
    
    val views = RemoteViews(context.packageName, R.layout.year_progress_widget)
    // ... 更新逻辑
}
```

### 查看日志

1. 打开 Android Studio 的 Logcat
2. 过滤标签："YearProgressWidget"
3. 观察日志输出

## 测试报告模板

```
测试日期：____
测试人员：____
设备型号：____
Android版本：____

功能测试结果：____
更新测试结果：____
交互测试结果：____
兼容性测试结果：____
视觉测试结果：____
性能测试结果：____
边界测试结果：____

发现问题：
1. ____
2. ____
3. ____

总体评价：____
```

## 性能指标

### 更新频率
- 推荐更新周期：1小时（3600000毫秒）
- 最小更新周期：30分钟（1800000毫秒）

### 内存占用
- 预期内存占用：< 5MB
- 测量内存占用：____

### 电量消耗
- 预期每小时消耗：< 0.5%
- 测量电量消耗：____

### 更新耗时
- 预期每次更新耗时：< 100ms
- 测量更新耗时：____

## 下一步

测试完成后，可以进入 [开发规划](DEVELOPMENT_PLAN.md) 的**阶段四：Todo List功能**

## 已知问题

### 问题1: 进度条样式限制
- RemoteViews对自定义ProgressBar样式支持有限
- 当前使用系统默认样式
- **计划**：在UI优化阶段统一美化

### 问题2: 自动更新未实现
- 当前依赖系统每小时更新
- 未实现WorkManager
- **计划**：在阶段九实现后台服务

### 问题3: 目标日期配置未实现
- 当前默认目标日期为新年
- 未实现用户自定义目标日期
- **计划**：在配置界面阶段实现

---

**状态**：基础功能开发完成，等待测试
**完成时间**：2026-01-23
**下一阶段**：阶段四 - Todo List功能
